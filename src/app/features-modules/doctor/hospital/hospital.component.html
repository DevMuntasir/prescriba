<div class="min-h-screen bg-brand-surface py-10">
  <div class="max-w-6xl mx-auto space-y-8 px-4">
    <header class="flex flex-wrap items-center justify-between gap-4">
      <div class="space-y-2">
        <p class="text-sm uppercase tracking-[0.3em] text-brand-primary font-semibold">Hospitals & chambers</p>
        <h1 class="text-3xl font-bold text-slate-900">Manage your locations</h1>
        <p class="text-slate-600 max-w-2xl text-base">Organize every address where you consult patients. Keep details
          accurate so patients know where to find you.</p>
      </div>
      <div class="flex items-center gap-3">
        <button type="button"
          class="px-4 py-2 rounded-xl bg-emerald-50 text-brand-primary font-semibold flex items-center gap-2"
          (click)="refresh()" [disabled]="isLoadingList">
          <svg viewBox="0 0 24 24" class="w-5 h-5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" fill="none"
              d="M4 4v6h6M20 20v-6h-6M5.1 12A7 7 0 0 1 12 5a7 7 0 0 1 6.9 5.7M18.9 12A7 7 0 0 1 12 19a7 7 0 0 1-6.9-5.7" />
          </svg>
          Refresh
        </button>
        <button type="button"
          class="px-5 py-2.5 rounded-xl bg-brand-primary text-white font-semibold shadow-lg shadow-brand-primary/30"
          (click)="openForm()" [disabled]="chamberForm.disabled">
          + New hospital
        </button>
      </div>
    </header>

    <section class="bg-white rounded-3xl shadow-2xl shadow-emerald-200/40 border border-emerald-50 p-8 space-y-5">
      <div *ngIf="loadError" class="rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
        {{ loadError }}
      </div>
      <div *ngIf="isLoadingList"
        class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
        Loading your saved locations...
      </div>
      <div *ngIf="!isLoadingList && !loadError && !hasChambers"
        class="rounded-2xl border-2 border-dashed border-brand-border bg-brand-surface/50 px-6 py-12 text-center">
        <svg class="mx-auto h-12 w-12 text-brand-primary/30" xmlns="http://www.w3.org/2000/svg" fill="none"
          viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
        </svg>
        <p class="mt-3 text-sm font-medium text-brand-neutral">No hospitals added yet</p>
        <p class="mt-1 text-xs text-brand-neutralSoft">Use the �New hospital� button to capture your first location.</p>
      </div>

      <div *ngIf="!isLoadingList && !loadError && hasChambers" class="space-y-4">
        <article *ngFor="let chamber of chambers; trackBy: trackByChamber"
          class="border border-slate-200 rounded-2xl p-6 bg-slate-50 hover:border-brand-primary/50 hover:shadow-lg transition">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
            <div class="min-w-0 flex-1">
              <h3 class="text-lg font-semibold text-slate-900 truncate">{{ chamber.chamberName }}</h3>
              <p class="mt-1 text-sm text-slate-600 truncate">{{ chamber.address }}</p>
              <p class="text-xs text-slate-500">
                {{ chamber.city }}{{ chamber.zipCode ? ', ' + chamber.zipCode : '' }}{{ chamber.country ? ', ' +
                chamber.country : '' }}
              </p>
              <span
                class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-bold whitespace-nowrap mt-3"
                [ngClass]="chamber.isVisibleOnPrescription ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path *ngIf="chamber.isVisibleOnPrescription" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2.5" d="M5 12l5 5L20 7"></path>
                  <path *ngIf="!chamber.isVisibleOnPrescription" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="2.5"
                    d="M13.875 18.825A10.05 10.05 0 0112 19c-5.523 0-10-4.477-10-10 0-1.463.313-2.851.875-4.106m2.476-2.476A9.956 9.956 0 0112 3c5.523 0 10 4.477 10 10 0 1.463-.313 2.851-.875 4.106M3 3l18 18" />
                </svg>
                {{ chamber.isVisibleOnPrescription ? 'Shown on prescription' : 'Hidden from prescription' }}
              </span>
            </div>
            <div>
              <div class="flex gap-2">
                <button type="button" class="btn-primary bg-brand-primary"
                  (click)="openScheduleBuilder(chamber.id ?? null)">
                  Schedule</button>
                <button type="button"
                  class="btn-primary bg-brand-primary/10 border-brand-border border-[1px] text-brand-primary hover:bg-white"
                  (click)="openForm(chamber)">
                  Edit</button>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>
  </div>

  <div class="fixed inset-0 z-40" *ngIf="isFormOpen">
    <div class="absolute inset-0 bg-slate-900/40" (click)="closeForm()"></div>
    <div class="absolute right-0 top-0 h-full w-full max-w-xl bg-white shadow-2xl flex flex-col">
      <header class="flex items-start justify-between gap-4 border-b border-slate-100 px-6 py-5">
        <div>
          <p class="text-sm uppercase tracking-[0.4em] text-brand-primary font-semibold">{{ editingChamberId ? 'Edit
            hospital' : 'New hospital' }}</p>
          <h2 class="text-2xl font-bold text-slate-900">{{ editingChamberId ? 'Update location details' : 'Add location
            details' }}</h2>
          <p class="text-slate-600 text-sm">Provide the address info that will appear inside your schedules and
            prescriptions.</p>
        </div>
        <button type="button" class="px-3 py-1 rounded-full bg-emerald-50 text-brand-primary font-semibold"
          (click)="closeForm()">Close</button>
      </header>

      <form class="flex-1 overflow-y-auto px-6 pb-8 pt-6 space-y-5" [formGroup]="chamberForm" (ngSubmit)="onSubmit()">
        <label class="flex flex-col gap-2 text-sm font-semibold text-slate-900">
          Hospital / Chamber Name
          <input type="text" formControlName="chamberName" placeholder="e.g. Apollo Hospitals, Dhanmondi"
            class="rounded-xl border border-slate-200 px-4 py-3 text-base font-normal text-slate-900 placeholder-slate-400"
            [class.border-red-400]="hasError('chamberName')" />
          <span *ngIf="hasError('chamberName')" class="text-xs font-medium text-red-600">{{
            getErrorMessage('chamberName') }}</span>
        </label>

        <label class="flex flex-col gap-2 text-sm font-semibold text-slate-900">
          Street Address
          <input type="text" formControlName="address" placeholder="Building number, street name, and floor details"
            class="rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 placeholder-slate-400"
            [class.border-red-400]="hasError('address')" />
          <span *ngIf="hasError('address')" class="text-xs font-medium text-red-600">{{ getErrorMessage('address')
            }}</span>
        </label>

        <div class="grid gap-4 md:grid-cols-2">
          <label class="flex flex-col gap-2 text-sm font-semibold text-slate-900">
            City
            <input type="text" formControlName="city" placeholder="Enter city name"
              class="rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 placeholder-slate-400"
              [class.border-red-400]="hasError('city')" />
            <span *ngIf="hasError('city')" class="text-xs font-medium text-red-600">{{ getErrorMessage('city') }}</span>
          </label>

          <label class="flex flex-col gap-2 text-sm font-semibold text-slate-900">
            Zip / Postal Code
            <input type="text" formControlName="zipCode" placeholder="Postal code"
              class="rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 placeholder-slate-400"
              [class.border-red-400]="hasError('zipCode')" />
            <span *ngIf="hasError('zipCode')" class="text-xs font-medium text-red-600">{{ getErrorMessage('zipCode')
              }}</span>
          </label>
        </div>

        <label class="flex flex-col gap-2 text-sm font-semibold text-slate-900">
          Country
          <input type="text" formControlName="country" placeholder="Country name"
            class="rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 placeholder-slate-400"
            [class.border-red-400]="hasError('country')" />
          <span *ngIf="hasError('country')" class="text-xs font-medium text-red-600">{{ getErrorMessage('country')
            }}</span>
        </label>

        <label class="inline-flex items-center gap-3 text-sm font-semibold text-slate-900">
          <input type="checkbox" formControlName="isVisibleOnPrescription"
            class="h-4 w-4 rounded border-slate-300 text-brand-primary focus:ring-brand-primary" />
          Show on prescription header
        </label>

        <div class="flex justify-end">
          <button type="submit"
            class="px-5 py-2.5 rounded-xl bg-brand-primary text-white font-semibold flex items-center gap-2"
            [disabled]="isSaving || chamberForm.disabled">
            <svg *ngIf="isSaving" class="w-4 h-4 animate-spin" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="10" stroke-width="4" stroke="currentColor" fill="none" class="opacity-30" />
              <path stroke-linecap="round" stroke="currentColor" stroke-width="4" d="M4 12a8 8 0 018-8" />
            </svg>
            Save location
          </button>
        </div>
      </form>
    </div>
  </div>

  <app-doctor-schedule-builder [isOpen]="isScheduleBuilderOpen" [doctorId]="doctorProfileId" [chambers]="chambers"
    [initialChamberId]="selectedScheduleChamberId" [chambersLoading]="isLoadingList" (closed)="closeScheduleBuilder()"
    (scheduleCreated)="handleScheduleCreated($event)"></app-doctor-schedule-builder>
</div>